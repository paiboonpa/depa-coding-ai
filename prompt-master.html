<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Master: Teen Edition</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts (Prompt for Thai) -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background-color: #020617;
            /* slate-950 */
            color: white;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="w-full max-w-3xl">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <script>
        // --- Data & State ---
        const allLevels = [
            { id: 1, title: "‡∏û‡∏µ‡πà‡∏™‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏á", mission: "‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏™‡∏á' ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•‡∏ü‡∏±‡∏á", constraints: "‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ '‡∏û‡∏∑‡∏ä', '‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ' ‡∏´‡∏£‡∏∑‡∏≠ '‡∏≠‡∏≠‡∏Å‡∏ã‡∏¥‡πÄ‡∏à‡∏ô' (‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô)", icon: "üå±" },
            { id: 2, title: "‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏Å‡∏£‡∏¥‡∏ö", mission: "‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏Ñ‡∏£‡∏π‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏¢ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ '‡πÅ‡∏°‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏û‡∏±‡∏á'", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏≤‡∏£ ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏Å‡∏´‡∏Å‡∏à‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ)", icon: "üòø" },
            { id: 3, title: "‡∏ô‡∏±‡∏Å‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á", mission: "‡∏ß‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏¥‡∏ß‡∏™‡∏≠‡∏ö 5 ‡∏ß‡∏¥‡∏ä‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2 ‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏≠‡∏ö", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏Å‡∏¥‡∏ô‡∏ä‡∏≤‡∏ô‡∏°‡πÑ‡∏Ç‡πà‡∏°‡∏∏‡∏Å ‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô)", icon: "üìÖ" },
            { id: 4, title: "‡∏û‡πà‡∏≠‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå", mission: "‡∏Ç‡∏≤‡∏¢ '‡∏¢‡∏≤‡∏á‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏Å‡πâ‡∏≠‡∏ô' ‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ô‡πà‡∏≤‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å", constraints: "‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ '‡∏°‡∏∑‡∏≠‡∏™‡∏≠‡∏á', '‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß' (‡πÄ‡∏ô‡πâ‡∏ô Storytelling)", icon: "‚úèÔ∏è" },
            { id: 5, title: "‡∏•‡πà‡∏≤‡∏°‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô", mission: "‡πÅ‡∏õ‡∏•‡∏Ñ‡∏≥‡πÅ‡∏™‡∏•‡∏á‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô‡πÑ‡∏ó‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô '‡∏â‡πà‡∏≥', '‡πÄ‡∏Å‡∏¥‡πä‡∏ô‡∏ô', '‡∏ß‡∏≤‡∏™‡∏ô‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏î') ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏≤‡∏¢‡∏ß‡∏±‡∏¢ 80 ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå", icon: "üëµ" },
            { id: 6, title: "‡∏ú‡∏π‡πâ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏ö‡∏ó‡πÉ‡∏´‡∏°‡πà", mission: "‡πÅ‡∏Å‡πâ‡∏ö‡∏ó‡∏´‡∏ô‡∏±‡∏á 'Avengers' ‡πÉ‡∏´‡πâ‡∏ò‡∏≤‡∏ô‡∏≠‡∏™‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏î‡∏ô‡∏¥‡πâ‡∏ß", constraints: "‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏∑‡∏≠ '‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÜ ‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢' ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", icon: "üß§" },
            { id: 7, title: "‡∏ô‡∏±‡∏Å‡πÇ‡∏ï‡πâ‡∏ß‡∏≤‡∏ó‡∏µ", mission: "‡∏´‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏• 3 ‡∏Ç‡πâ‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ô‡πâ‡∏°‡∏ô‡πâ‡∏≤‡∏ß‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡∏ß‡πà‡∏≤ '‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô'", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏°‡∏°‡∏ï‡∏¥ ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö", icon: "üéÆ" },
            { id: 8, title: "AI ‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°", mission: "‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ '‡∏û‡∏£‡∏∞‡∏≠‡∏†‡∏±‡∏¢‡∏°‡∏ì‡∏µ' ‡∏ï‡∏≠‡∏ô‡∏´‡∏ô‡∏µ‡∏ô‡∏≤‡∏á‡∏ú‡∏µ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏™‡∏°‡∏∏‡∏ó‡∏£ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏û‡∏™‡∏ï‡πå Twitter (X)", constraints: "‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Å‡∏¥‡∏ô 280 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ Hashtag ‡∏Æ‡∏≤‡πÜ", icon: "üê¶" },
            { id: 9, title: "‡πÄ‡∏ä‡∏ü‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô", mission: "‡∏ö‡∏≠‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡∏≤‡∏Å '‡∏°‡∏≤‡∏°‡πà‡∏≤ 1 ‡∏ã‡∏≠‡∏á ‡∏Å‡∏±‡∏ö‡πÑ‡∏Ç‡πà 1 ‡∏ü‡∏≠‡∏á' ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏´‡∏•‡∏≤", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ (‡∏†‡∏≤‡∏©‡∏≤‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) ‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡∏±‡∏î‡∏à‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö Fine Dining", icon: "üçú" },
            { id: 10, title: "‡∏ô‡∏±‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏•‡∏Å", mission: "‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô' ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô", constraints: "‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏Å‡∏±‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÜ)", icon: "üè´" }
        ];

        let levels = [];

        let state = {
            screen: 'intro', // intro, playing, result, finished
            currentLevelIndex: 0,
            totalScore: 0,
            history: [],
            feedback: null,
            loading: false
        };

        // Try to get key from injected environment, otherwise fallback (or fail)
        const apiKey = window.ENV?.GEMINI_KEY || "YOUR_FALLBACK_KEY_OR_ERROR";


        // --- Render Functions ---

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = ''; // Clear content

            if (state.screen === 'intro') {
                app.innerHTML = renderIntro();
            } else if (state.screen === 'playing') {
                app.innerHTML = renderPlaying();
            } else if (state.screen === 'result') {
                app.innerHTML = renderResult();
            } else if (state.screen === 'finished') {
                app.innerHTML = renderFinished();
            }

            // Re-initialize icons
            lucide.createIcons();

            // Re-attach event listeners (since we cleared innerHTML)
            attachListeners();
        }

        function renderIntro() {
            return `
                <div class="flex flex-col items-center justify-center min-h-[500px] text-center p-8 space-y-6 animate-fade-in">
                    <div class="bg-gradient-to-r from-purple-500 to-pink-500 p-4 rounded-full shadow-lg shadow-purple-500/30">
                        <i data-lucide="gamepad-2" class="w-16 h-16 text-white"></i>
                    </div>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                        Prompt Master
                        <span class="block text-2xl mt-2 text-gray-400 font-medium">Teen Edition üéÆ</span>
                    </h1>
                    <p class="text-gray-300 max-w-lg text-lg">
                        ‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô AI ‡∏ú‡πà‡∏≤‡∏ô 10 ‡∏î‡πà‡∏≤‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡∏ß‡∏ô <br/>
                        ‡∏ß‡∏±‡∏î‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà <strong>‡πÑ‡∏´‡∏ß‡∏û‡∏£‡∏¥‡∏ö</strong> ‡πÅ‡∏•‡∏∞ <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πä‡∏∞</strong> ‡∏Ç‡∏≠‡∏á Prompt!
                    </p>
                    
                    <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700 max-w-md w-full text-left space-y-3 mx-auto">
                        <h3 class="font-bold text-pink-400 flex items-center gap-2">
                            <i data-lucide="sparkles" class="w-4 h-4"></i> ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô
                        </h3>
                        <ul class="text-sm text-gray-300 space-y-2 list-disc list-inside">
                            <li>‡∏≠‡πà‡∏≤‡∏ô‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏î‡∏µ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å!)</li>
                            <li>‡∏û‡∏¥‡∏°‡∏û‡πå Prompt ‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á AI</li>
                            <li>AI ‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (0-10)</li>
                            <li><strong>‡πÉ‡∏´‡∏°‡πà!</strong> ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ï‡πá‡∏° AI ‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡∏î‡πâ‡∏ß‡∏¢</li>
                        </ul>
                    </div>

                    <button id="btn-start" class="group relative px-8 py-4 bg-white text-purple-900 font-bold text-xl rounded-full hover:scale-105 transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] overflow-hidden">
                        <span class="relative z-10 flex items-center gap-2">
                            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢! <i data-lucide="play" class="w-5 h-5"></i>
                        </span>
                    </button>
                </div>
            `;
        }

        function renderPlaying() {
            const level = levels[state.currentLevelIndex];

            return `
                <div class="animate-fade-in">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-6 bg-slate-800/80 p-4 rounded-xl border border-slate-700">
                        <div class="flex items-center gap-3">
                            <div class="bg-purple-600 w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl">
                                ${level.id}
                            </div>
                            <div>
                                <div class="text-xs text-purple-300 font-bold uppercase tracking-wider">Level ${state.currentLevelIndex + 1}/${levels.length}</div>
                                <div class="font-bold text-white">${level.title}</div>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="text-xs text-gray-400">Total Score</span>
                            <span class="text-2xl font-bold text-green-400">${state.totalScore}</span>
                        </div>
                    </div>

                    <!-- Mission -->
                    <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-slate-700 rounded-2xl p-6 md:p-8 mb-6 shadow-xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl select-none grayscale">
                            ${level.icon}
                        </div>
                        <div class="relative z-10 space-y-6">
                            <div>
                                <h3 class="text-purple-400 font-bold mb-2 flex items-center gap-2">
                                    <i data-lucide="trophy" class="w-4 h-4"></i> ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à (The Mission)
                                </h3>
                                <p class="text-xl md:text-2xl text-white font-medium leading-relaxed">
                                    ${level.mission}
                                </p>
                            </div>
                            <div class="bg-red-500/10 border border-red-500/30 p-4 rounded-xl">
                                <h3 class="text-red-400 font-bold mb-1 flex items-center gap-2">
                                    <i data-lucide="alert-circle" class="w-4 h-4"></i> ‡∏Ç‡πâ‡∏≠‡∏´‡πâ‡∏≤‡∏° & ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (Constraints)
                                </h3>
                                <p class="text-red-100 font-light">
                                    ${level.constraints}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="space-y-4">
                        <label class="text-gray-400 text-sm ml-1 flex justify-between">
                            <span>‡∏û‡∏¥‡∏°‡∏û‡πå Prompt ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà:</span>
                            <span class="text-purple-400 text-xs">‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏£‡∏∞‡∏ö‡∏∏‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (Role) ‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏¢‡∏≠‡∏∞!</span>
                        </label>
                        <textarea id="prompt-input"
                            placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: '‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô... ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô...'"
                            class="w-full h-40 bg-slate-950 border border-slate-700 rounded-xl p-4 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all placeholder:text-slate-600 resize-none font-mono text-sm md:text-base"
                        ></textarea>
                        
                        <button id="btn-submit" class="w-full py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 transition-all bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:shadow-lg hover:shadow-purple-500/25 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                            ${state.loading
                    ? `<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à...`
                    : `‡∏™‡πà‡∏á Prompt ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à <i data-lucide="send" class="w-5 h-5"></i>`
                }
                        </button>
                    </div>
                </div>
            `;
        }

        function renderResult() {
            const feedback = state.feedback;
            const isPass = feedback.score >= 7;
            const scoreColor = feedback.score >= 8 ? 'text-green-400' : feedback.score >= 5 ? 'text-yellow-400' : 'text-red-400';
            const icon = isPass ? 'check-circle-2' : 'alert-circle';
            const statusText = isPass ? '‡∏ú‡πà‡∏≤‡∏ô‡∏â‡∏•‡∏∏‡∏¢!' : '‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏î‡πà‡∏ß‡∏ô!';
            const statusClass = isPass ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400';

            return `
                <div class="animate-fade-in w-full">
                    <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 text-center space-y-6">
                        <div class="space-y-2">
                            <h2 class="text-gray-400 uppercase tracking-widest text-sm">Score</h2>
                            <div class="text-6xl md:text-7xl font-black ${scoreColor} drop-shadow-lg">
                                ${feedback.score}<span class="text-2xl text-gray-500">/10</span>
                            </div>
                        </div>

                        <div class="inline-flex items-center gap-2 px-4 py-1 rounded-full text-sm font-bold ${statusClass}">
                            <i data-lucide="${icon}" class="w-4 h-4"></i>
                            ${statusText}
                        </div>

                        <div class="bg-slate-900/50 p-6 rounded-xl text-left space-y-4">
                            <div>
                                <div class="text-purple-400 text-xs font-bold uppercase mb-1">AI Comment</div>
                                <p class="text-white text-lg">"${feedback.comment}"</p>
                            </div>
                            
                            ${feedback.violation ? `
                                <div class="p-3 bg-red-500/10 border border-red-500/20 rounded-lg">
                                    <div class="text-red-400 text-xs font-bold uppercase mb-1">Violation Detected</div>
                                    <p class="text-red-200 text-sm">${feedback.violation}</p>
                                </div>
                            ` : ''}

                            ${(feedback.suggestion && feedback.score < 10) ? `
                                <div class="p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">
                                    <div class="text-yellow-400 text-xs font-bold uppercase mb-1 flex items-center gap-1">
                                         <i data-lucide="lightbulb" class="w-3 h-3"></i> Tip: ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏° 10
                                    </div>
                                    <p class="text-yellow-100 text-sm">${feedback.suggestion}</p>
                                </div>
                            ` : ''}

                            <div class="pt-4 border-t border-slate-700">
                                <div class="text-gray-500 text-xs font-bold uppercase mb-2">Simulated Output (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏≠‡∏Å‡∏°‡∏≤)</div>
                                <div class="bg-slate-950 p-3 rounded text-gray-300 text-sm font-mono italic border-l-4 border-purple-500">
                                    ${feedback.simulated_output}
                                </div>
                            </div>
                        </div>

                        <button id="btn-next" class="w-full py-4 bg-white text-slate-900 rounded-xl font-bold text-lg hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                            ${state.currentLevelIndex < levels.length - 1 ? '‡πÑ‡∏õ‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ' : '‡∏î‡∏π‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°'} 
                            <i data-lucide="chevron-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderFinished() {
            let rank = "Novice Prompter";
            let message = "‡∏ù‡∏∂‡∏Å‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞!";
            if (state.totalScore >= 90) { rank = "God of Prompt"; message = "‡∏ô‡∏µ‡πà‡∏°‡∏±‡∏ô‡πÄ‡∏ó‡∏û‡∏à‡∏∏‡∏ï‡∏¥‡∏ä‡∏±‡∏î‡πÜ!"; }
            else if (state.totalScore >= 75) { rank = "Prompt Master"; message = "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏Å‡∏•‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô"; }
            else if (state.totalScore >= 50) { rank = "Apprentice"; message = "‡∏°‡∏µ‡πÅ‡∏ß‡∏ß‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏´‡∏ô‡πà‡∏≠‡∏¢"; }

            let historyHtml = state.history.map(h => `
                <div class="text-sm border-b border-slate-800 pb-2">
                    <div class="flex justify-between text-purple-300">
                        <span>Level ${h.level}: ${h.title}</span>
                        <span class="${h.score >= 7 ? 'text-green-400' : 'text-red-400'}">${h.score}/10</span>
                    </div>
                    <div class="text-gray-500 truncate mt-1">"${h.prompt}"</div>
                </div>
            `).join('');

            return `
                <div class="w-full animate-fade-in text-center">
                    <div class="bg-gradient-to-b from-slate-800 to-slate-900 p-8 md:p-12 rounded-3xl border border-slate-700 shadow-2xl space-y-8">
                        <div class="inline-block p-6 bg-yellow-500/20 rounded-full mb-4">
                            <i data-lucide="trophy" class="w-16 h-16 text-yellow-400"></i>
                        </div>

                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">Game Over!</h2>
                            <div class="text-6xl md:text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 via-pink-500 to-red-500">
                                ${state.totalScore}
                            </div>
                            <p class="text-gray-400 mt-2">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏° 100</p>
                        </div>

                        <div class="bg-slate-950/50 p-6 rounded-xl border border-slate-800">
                            <div class="text-gray-500 uppercase text-xs tracking-widest mb-2">Your Rank</div>
                            <div class="text-2xl md:text-3xl font-bold text-white">${rank}</div>
                            <p class="text-purple-300 mt-2">${message}</p>
                        </div>

                        <div class="space-y-4 text-left max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                            <h3 class="text-white font-bold sticky top-0 bg-slate-900 py-2">History</h3>
                            ${historyHtml}
                        </div>

                        <button id="btn-restart" class="px-8 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-full font-bold transition-all flex items-center justify-center gap-2 mx-auto">
                            <i data-lucide="rotate-ccw" class="w-4 h-4"></i> ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                        </button>
                    </div>
                </div>
            `;
        }

        function attachListeners() {
            const btnStart = document.getElementById('btn-start');
            if (btnStart) btnStart.addEventListener('click', startGame);

            const btnSubmit = document.getElementById('btn-submit');
            if (btnSubmit) btnSubmit.addEventListener('click', submitPrompt);

            const btnNext = document.getElementById('btn-next');
            if (btnNext) btnNext.addEventListener('click', nextLevel);

            const btnRestart = document.getElementById('btn-restart');
            if (btnRestart) btnRestart.addEventListener('click', startGame);
        }

        // --- Logic ---

        function startGame() {
            // Randomly select 5 levels from the pool
            levels = [...allLevels].sort(() => 0.5 - Math.random()).slice(0, 5);

            state.currentLevelIndex = 0;
            state.totalScore = 0;
            state.history = [];
            state.feedback = null;
            state.screen = 'playing';
            render();
        }

        async function submitPrompt() {
            const promptInput = document.getElementById('prompt-input');
            const promptText = promptInput.value.trim();

            if (!promptText) return;

            state.loading = true;
            render(); // Re-render to show loading state

            const currentLevel = levels[state.currentLevelIndex];

            // Note: In a real HTML file, keep your API Key secret. 
            // For this generated file, it relies on the user providing one or handling it backend.
            // Since this is a demo running in a controlled environment, we use the injected key.

            const systemPrompt = `
                You are a strict but humorous judge for a "Prompt Engineering Game" called "Prompt Master: Teen Edition". 
                Mission: "${currentLevel.mission}"
                Constraints: "${currentLevel.constraints}"
                Player's Prompt: "${promptText}"

                Analyze carefully.
                1. Did they follow constraints? (Negative constraint violation = -5 points).
                2. Is structure good?
                3. Is it creative?

                Return JSON ONLY:
                {
                  "score": number (0-10),
                  "comment": "Thai teen style comment",
                  "violation": "string or null",
                  "simulated_output": "Short simulated AI output",
                  "suggestion": "Thai suggestion to get 10/10 if score < 10"
                }
            `;

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: systemPrompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        }),
                    }
                );

                if (!response.ok) throw new Error("API Error");

                const data = await response.json();
                const resultText = data.candidates[0].content.parts[0].text;
                const result = JSON.parse(resultText);

                state.feedback = result;
                state.totalScore += result.score;
                state.history.push({
                    level: currentLevel.id,
                    title: currentLevel.title,
                    prompt: promptText,
                    score: result.score
                });
                state.screen = 'result';

            } catch (error) {
                console.error(error);
                state.feedback = {
                    score: 5,
                    comment: "‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏ß‡∏ô‡πÄ‡∏â‡∏¢! ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ 5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞",
                    violation: "Connection Error",
                    simulated_output: "Error...",
                    suggestion: "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô"
                };
                state.screen = 'result';
            } finally {
                state.loading = false;
                render();
            }
        }

        function nextLevel() {
            if (state.currentLevelIndex < levels.length - 1) {
                state.currentLevelIndex++;
                state.feedback = null;
                state.screen = 'playing';
            } else {
                state.screen = 'finished';
            }
            render();
        }

        // --- Init ---
        render();

    </script>
    <!-- Home Button -->
    <a href="index.html"
        class="fixed bottom-4 right-4 z-50 bg-slate-800/80 text-purple-400 border border-purple-500/30 px-6 py-3 rounded-full font-bold shadow-lg hover:bg-purple-600 hover:text-white transition-all flex items-center gap-2 text-sm backdrop-blur-sm">
        <i data-lucide="home" class="w-4 h-4"></i>
        HOME
    </a>
</body>

</html>